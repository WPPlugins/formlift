<?php/** * Created by PhpStorm. * User: Adrian * Date: 2016-10-29 * Time: 5:54 PM */class Flp_Edit_Box{    var $ID;    var $form;    public function __construct($post_id)    {        $this->ID = $post_id;        $this->form = new Flp_Form($post_id);    }    /**     * display the initial page for the HTML editor meta box     */    public function create_page()    {        wp_nonce_field( 'save_form', 'infusion_nonce_field');        ?>        <table>            <tr>                <td><label for="form_shortcode_area"></label><input class="flp-input" id="form_shortcode_area" type="text" value='[infusion_form id="<?php echo $this->ID ?>"]' readonly/></td>                <td><button type="button" class="flp-button flp-copy-shortcode-button" onclick="copy_shortcode('#form_shortcode_area')">COPY SHORTCODE</button></td>            </tr>        </table>        <?php $this->create_html_editor()?>        <?php    }    /**     * create the HTML editor     */    private function create_html_editor()    {        ?>        <?php $url = FLP_PLUGIN_DIR_URI;?>        <link rel=stylesheet href="<?php echo $url?>codemirror/lib/codemirror.css">        <script src="<?php echo $url?>codemirror/lib/codemirror.js"></script>        <script src="<?php echo $url?>codemirror/mode/xml/xml.js"></script>        <script src="<?php echo $url?>codemirror/mode/javascript/javascript.js"></script>        <script src="<?php echo $url?>codemirror/mode/css/css.js"></script>        <script src="<?php echo $url?>codemirror/mode/htmlmixed/htmlmixed.js"></script>        <script src="<?php echo $url?>codemirror/addon/edit/matchbrackets.js"></script>        <script src="<?php echo $url?>codemirror/lib/autoformatextension.js"></script>        <style>            #minor-publishing-actions #preview-action{                display: none;            }        </style>        <div class="container" id="codeditor">            <textarea hidden title="Form Code" id="form_code" name="form_code" rows="25" style="width:100%"><?php echo $this->form->get_encoded_form_code()?></textarea>        </div>        <script>            var textarea = document.getElementById("form_code");            var flpCodeMirror = CodeMirror.fromTextArea(textarea, {                lineNumbers: true,                mode: "text/html",                matchBrackets: true,                indentUnit: 4,                specialChars: /[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/            });            function autoFormat() {                var totalLines = flpCodeMirror.lineCount();                var totalChars = flpCodeMirror.getLine(totalLines - 1).length;                flpCodeMirror.autoFormatRange({line: 0, ch: 0}, {line: totalLines, ch: totalChars});            }            autoFormat();        </script>        <?php    }}